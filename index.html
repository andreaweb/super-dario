<!doctype html>
<html>
  <head>
    <title>Getting Started</title>
    <link href="src/style.css" rel="stylesheet">
  </head>
  <body>
	<div class="container">
	  	<div class="bg"></div>	
	  	<img class="title" src="images/title-en.png">
	  	<div class="ground"></div>
	  	<div class="dario"></div>
	  	<button class="tap">
	  		<span class="span">Play Now!</span>
	  		<img class="arrow" src="images/tap.png">
	  	</button>
	  	<div class="bullet"></div>
	</div>

    <script src="dist/main.js"></script>
    <script>
    //if all I need to do is make Dario jump, I can probably do it with CSS alone
    //if I need to make him die too, CSS might not be enough, but could give it a shot

   
    //check bullet's left location and if .dario:not(.small):not(.up) add class small to dario
    
  //   if(document.getElementsByTagName("body")[0].className.split(' ').indexOf('freeze') > -1){
  //   	//game is frozen, no need to check for collisions
  //   }else{
		// timer = setInterval(checkCol, 200); 
  //   }
  	let gameStart = document.getElementsByClassName("tap")[0];
	let gameOn = false;

	gameStart.addEventListener("click", (event) => {
		document.getElementsByClassName("container")[0].className = document.getElementsByClassName("container")[0].className.concat(' game-on');
		gameStart.className = gameStart.className.concat(' display-none');
		document.getElementsByClassName("title")[0].className = document.getElementsByClassName("title")[0].className.concat(' display-none');
		gameOn = true;
		startGame()
	})

  	function startGame(){
  		let timer = setInterval(checkCol, 200); 

		function checkCol(){
			if(!gameOn){
	  			return false;
	  		}
	    	let bulletPos = document.getElementsByClassName("bullet")[0].offsetLeft;
	    	let darioPos = document.getElementsByClassName("dario")[0].offsetLeft;
	    	let darioClasses = document.getElementsByClassName("dario")[0].className.split(' ');
	    	let darioJump = darioClasses.indexOf('up');
	    	let darioSmall = darioClasses.indexOf('small');

	    	console.log(bulletPos);

	    	//darioPos-40 54
	    	//darioPos 94
	    	if(bulletPos > darioPos && bulletPos < darioPos+40){
	    		if(darioJump == -1 && darioSmall == -1){ /*dario did not jump (did not dodge bullet), dario is not small*/
	    			console.log('Dario will become small')
	    			document.getElementsByClassName("dario")[0].className = document.getElementsByClassName("dario")[0].className.concat(' small');
	    			return; //avoid else triggering immediately
	    		}else if(darioJump == -1 && darioSmall > -1){/*dario did not dodge bullet, dario is small*/
	    			console.log('Dario will fade and game will freeze');
	    			console.log(document.getElementsByTagName("body")[0].className);
	    			console.log(document.getElementsByTagName("body")[0]);
	    			document.getElementsByClassName("dario")[0].className = document.getElementsByClassName("dario")[0].className.concat(' fade');
	    			document.getElementsByTagName("body")[0].className = document.getElementsByTagName("body")[0].className.concat(' freeze');
	    			gameOn = false;
	    		}
		    }
		}

		// Dario jumps when any key is pressed
		document.addEventListener("keypress", (event) => {
			//adds class that makes him jump...
			document.getElementsByClassName("dario")[0].className =  document.getElementsByClassName("dario")[0].className.concat(' up');

			//but just for half a sec!
			setTimeout(function () { 
	    		document.getElementsByClassName("dario")[0].className = document.getElementsByClassName("dario")[0].className.replace(/\bup\b/, "");
				console.log("Dario jumps")
			}, 500);
		});
  	}
    </script>
  </body>
</html>